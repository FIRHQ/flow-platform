version: 2
name: root

vars:
  FLOW_WORKSPACE: "echo hello"
  FLOW_VERSION: "echo version"

condition: |
  return $FLOWCI_GIT_BRANCH == "develop" || $FLOWCI_GIT_BRANCH == "master";

agents:
  - "dev"
  - "stage"
  - "prod"

dockers:
  - image: "helloworld:0.1"

steps:
  step-1:
    bash: "echo step 1"

  step-2:
    bash: "echo step 2"
    dependencies:
      - step-1
    steps:
      step-2-1:
        bash: "echo step-2-1"
      step-2-2:
        bash: "echo step-2-2"

  step-3:
    bash: "echo step 3"
    dependencies:
      - step-1
    steps:
      step-3-1:
        bash: "echo step-3-1"

  step-4:
    bash: "echo step 4"
    dependencies:
      - step-2
      - step-3
    artifacts:
      - name: jar
        paths: [ "/path/jar", "/var/pwd" ]

  step-5:
    bash: "echo step 5"
    dependencies:
      - step-4

  #
  #       / 2 (2.1 - > 2.2) \
  #    1                      4 - > 5
  #       \ 3 (3.1 -> 3.2)  /
  #
